$(document).ready(function(){$("#imageConvert").on("click",function(){$(".inven .equ .option.selected").length>0?($("#previewImg").addClass("loading").removeClass("complate").empty(),$(".down-notice").addClass("loading").removeClass("complate").html("이미지를 생성중입니다. 잠시 기다려주세요."),$("html, body").animate({scrollTop:parseInt($("#download").offset().top-120)},500),setTimeout(function(){html2canvas(document.getElementById("imageCanvas"),{allowTaint:!0,useCORS:!0,scale:2}).then(function(t){$("#previewImg").removeClass("loading").addClass("complate").html('<img src="'+t.toDataURL()+'">'),$("html, body").animate({scrollTop:parseInt($("#download").offset().top-120)},500),$(".down-notice").removeClass("loading").addClass("complate").html("이미지가 생성되었습니다!")})},500)):D4SkillDB.layerFunc("selectAspect",!0,"선택된 위상이 없습니다<br>1개 이상의 위상 선택후 이미지를 생성해주세요.",!1)}),D4SkillDB.scrollFunc(),$("#container .box-url .setting-url").each(function(){""!==$(this).val()&&D4SkillDB.expandFunc($("#container .box-title .button-url-link"),!0)})});var D4SkillDB=function(){var t={},a={},e=[{display:"show",ver:"ori",job:"com",grade:"nor",parts:"com",icon:"rub",type:"com",name:"루비",detail:'<p class="gem_effect"><span class="wep">제압 피해 <span class="c_number">24%</span> 증가</span><span class="def">최대 생명력 <span class="c_number">4%</span> 증가</span><span class="acc">화염 저항력 <span class="c_number">24.1%</span> 증가</span></p>'},{display:"show",ver:"ori",job:"com",grade:"nor",parts:"com",icon:"sap",type:"com",name:"사파이어",detail:'<p class="gem_effect"><span class="wep">군중 제어 효과 영향을 받는 적에게 주는 극대화 피해 <span class="c_number">12%</span> 증가</span><span class="def">보강 상태에서 피해 <span class="c_number">3%</span> 감소</span><span class="acc">냉기 저항 <span class="c_number">22.1%</span> 증가</span></p>'},{display:"show",ver:"ori",job:"com",grade:"nor",parts:"com",icon:"toz",type:"com",name:"토파즈",detail:'<p class="gem_effect"><span class="wep">기본 기술 피해 <span class="c_number">20%</span> 증가</span><span class="def">제어 방해 효과를 받을 때 피해 <span class="c_number">10%</span> 감소</span><span class="acc">번개 저항 <span class="c_number">22.1%</span> 증가</span></p>'},{display:"show",ver:"ori",job:"com",grade:"nor",parts:"com",icon:"eme",type:"com",name:"에메랄드",detail:'<p class="gem_effect"><span class="wep">취약한 적에게 주는 극대화 피해 <span class="c_number">12%</span> 증가</span><span class="def">가시 <span class="c_number">+250</span> 증가</span><span class="acc">독 저항 <span class="c_number">22.1%</span> 증가</span></p>'},{display:"show",ver:"ori",job:"com",grade:"nor",parts:"com",icon:"ame",type:"com",name:"자수정",detail:'<p class="gem_effect"><span class="wep">지속 피해 <span class="c_number">8%</span> 증가</span><span class="def">지속 피해 <span class="c_number">8%</span> 감소</span><span class="acc">암흑 저항 <span class="c_number">22.1%</span> 증가</span></p>'},{display:"show",ver:"ori",job:"com",grade:"nor",parts:"com",icon:"dia",type:"com",name:"다이아몬드",detail:'<p class="gem_effect"><span class="wep">궁극기 공격력 <span class="c_number">15%</span> 상승</span><span class="def">보호막 생성량 <span class="c_number">5%</span> 증가</span><span class="acc">모든 원소 저항 <span class="c_number">22.1%</span> 증가</span></p>'},{display:"show",ver:"ori",job:"com",grade:"nor",parts:"com",icon:"skl",type:"com",name:"해골",detail:'<p class="gem_effect"><span class="wep">처치 시 생명력 <span class="c_number">+24</span> 회복</span><span class="def">받는 치유량 <span class="c_number">5%</span> 증가</span><span class="acc">방어도 <span class="c_number">+250</span> 상승</span></p>'},{display:"show",ver:"sea1",job:"com",grade:"leg",parts:"acc",icon:"off",type:"off",name:"피카나의(사악함, 공격력)",detail:'<p class="gem_effect"><span class="acc">극대화 적중 시 적이 0.75~2.50초 동안 전기를 띱니다. 전기를 띤 대상들 간에 번개가 튀며 68~136의 번개 피해를 줍니다.</span></p>'},{display:"show",ver:"sea1",job:"com",grade:"leg",parts:"acc",icon:"off",type:"off",name:"어두운 춤의(사악함, 공격력 - 단계 III)",detail:'<p class="gem_effect"><span class="acc">생명력이 60% 이상인 경우, 핵심 기술이 5초마다 주 자원 대신 68~51의 생명력을 사용합니다. 생명력을 소모한 기술은 10~20% 증가한 피해를 줍니다.</span></p>'},{display:"show",ver:"sea1",job:"com",grade:"leg",parts:"acc",icon:"off",type:"off",name:"유혹적인 운명의(사악함, 공격력 - 단계 III)",detail:'<p class="gem_effect"><span class="acc">극대화 적중 시 40~60%의 추가 피해를 주지만, 비 극대화 적중 시 주는 피해가 20~15% 감소합니다.</span></p>'},{display:"show",ver:"sea1",job:"com",grade:"leg",parts:"acc",icon:"def",type:"def",name:"사자심장의(흉포함, 방어력)",detail:'<p class="gem_effect"><span class="acc">보호막 생성량이 10% 증가합니다. 보호막이 활성화된 동안 매초 3~7의 생명력을 회복합니다.</span></p>'},{display:"show",ver:"sea1",job:"com",grade:"leg",parts:"acc",icon:"def",type:"def",name:"보복의(흉포함, 방어력 - 단계 III)",detail:'<p class="gem_effect"><span class="acc">받는 피해의 10~20%가 억제됩니다. 방어, 기만, 또는 섬뜩함 기술을 사용하면 억제되었던 모든 피해가 250% 증폭되어 폭발하며 주위의 적들에게 최대 1360~2040의 화염 피해를 줍니다.</span></p>'},{display:"show",ver:"sea1",job:"com",grade:"leg",parts:"acc",icon:"def",type:"def",name:"신중한 마음의(흉포함, 방어력 - 단계 III)",detail:'<p class="gem_effect"><span class="acc">일격에 20% 이상의 생명력을 잃을 경우, 2.0~4.0초간 면역을 얻습니다. 이 효과는 110초에 한 번씩만 발동합니다.</span></p>'},{display:"show",ver:"sea1",job:"com",grade:"leg",parts:"acc",icon:"uti",type:"uti",name:"결의의(간악함, 보조)",detail:'<p class="gem_effect"><span class="acc">자원 고갈 효과가 40~50% 감소합니다. 추가로, 자원 생성량이 3.0~8.0% 증가합니다.</span></p>'},{display:"show",ver:"sea1",job:"com",grade:"leg",parts:"acc",icon:"uti",type:"uti",name:"반격의(간악함, 보조 - 단계 III)",detail:'<p class="gem_effect"><span class="acc">자신에게 걸린 군중 제어 효과가 제거될 때마다 주위 적들에게 510~680의 화염 피해를 줍니다.</span></p>'},{display:"show",ver:"sea1",job:"com",grade:"leg",parts:"acc",icon:"uti",type:"uti",name:"치밀한 자의(간악함, 보조 - 단계 III)",detail:'<p class="gem_effect"><span class="acc">주 자원을 150~200 소모하면 다음 공격에 적중당한 적을 2초 동안 기절시킵니다.</span></p>'},{display:"show",ver:"sea1",job:"com",grade:"leg",parts:"acc",icon:"tra",type:"tra",name:"악의 맹약의(진노함, 초월적)",detail:'<p class="gem_effect"><span class="acc">적을 20마리 처치할 때마다 악의 보너스를 돌아가며 적용받습니다. <span class="text-block">사악함 : 공격 속도를 20% 획득합니다.</span><span class="text-block">간악함: 핵심 및 기본 기술이 15% 확률로 자원을 완전히 회복시킵니다.</span><span class="text-block">흉포함: 21초마다 85~102 피해를 흡수하는 보호막을 획득합니다.</span></span></p>'},{display:"show",ver:"sea1",job:"com",grade:"leg",parts:"acc",icon:"tra",type:"tra",name:"죄어오는 죽음의(진노함, 초월적)",detail:'<p class="gem_effect"><span class="acc">대상에게 걸린 서로 다른 군중 제어 효과 하나당 지속 피해 효과가 30~40% 증가합니다. 저지 불가 상태의 괴물과 비틀거리는 우두머리는 그 대신 지속 피해 효과로부터 110~130%의 추가 피해를 받습니다.</span></p>'},{display:"show",ver:"sea1",job:"com",grade:"leg",parts:"acc",icon:"tra",type:"tra",name:"이발사의(진노함, 초월적 - 단계 III)",detail:'<p class="gem_effect"><span class="acc">2.0~4.0초 동안 대상이 받은 극대화 피해와 그 이후의 모든 피해를 흡수합니다. 그 후, 흡수된 피해가 한꺼번에 주위의 적들을 향해 폭발합니다. 축적된 피해는 매초 10% 증가합니다.</span></p>'},{display:"show",ver:"sea1",job:"bab",grade:"leg",parts:"acc",icon:"off",type:"off",name:"집중된 분노의(사악함, 공격력)",detail:'<p class="gem_effect"><span class="acc">2초 내에 100~60 분노를 사용한 이후, 비 기본 기술의 극대화 확률이 20~30% 증가합니다.</span></p>'},{display:"show",ver:"sea1",job:"bab",grade:"leg",parts:"acc",icon:"def",type:"def",name:"되살아나는 생명력의(흉포함, 방어력)",detail:'<p class="gem_effect"><span class="acc">생명력이 40~60% 이하인 경우, 모든 출처에서 받는 회복량이 50~60% 증가합니다.</span></p>'},{display:"show",ver:"sea1",job:"bab",grade:"leg",parts:"acc",icon:"uti",type:"uti",name:"무시무시한 속도의(간악함, 보조)",detail:'<p class="gem_effect"><span class="acc">기술의 공격 속도가 20~35%보다 높으면 기술이 20~30% 확률로 모든 적을 1.25초 동안 넘어뜨립니다.</span></p>'},{display:"show",ver:"sea1",job:"bab",grade:"leg",parts:"acc",icon:"tra",type:"tra",name:"고통 감내의(진노함, 초월적 - 단계 IV)",detail:'<p class="gem_effect"><span class="acc">받는 피해가 5~15% 확률로 무시되고 대신 생명력을 17~68 회복합니다.</span></p>'},{display:"show",ver:"sea1",job:"dru",grade:"leg",parts:"acc",icon:"off",type:"off",name:"분노하는 달의(사악함, 공격력)",detail:'<p class="gem_effect"><span class="acc">처치 시 5% 확률로 늑대 동료를 20~30초 동안 소환합니다. 추가로 늑대 기술의 등급이 +3 증가합니다.</span></p>'},{display:"show",ver:"sea1",job:"dru",grade:"leg",parts:"acc",icon:"def",type:"def",name:"동요하는 바람의(흉포함, 방어력) ",detail:'<p class="gem_effect"><span class="acc">근거리에 적이 8~13마리 있을 때 자동으로 회오리 갑옷을 시전합니다. 이 효과는 10~20초에 한 번씩만 발동합니다.</span></p>'},{display:"show",ver:"sea1",job:"dru",grade:"leg",parts:"acc",icon:"uti",type:"uti",name:"거침없는 힘의(간악함, 보조)",detail:'<p class="gem_effect"><span class="acc">궁극기가 활성화되어 있는 동안 원거리에 있는 적 최대 30~50마리를 자신에게 끌어옵니다.</span></p>'},{display:"show",ver:"sea1",job:"dru",grade:"leg",parts:"acc",icon:"tra",type:"tra",name:"고삐 풀린 야수의(진노함, 초월적 - 단계 IV)",detail:'<p class="gem_effect"><span class="acc">기절, 빙결 또는 넘어뜨리기 효과에 적중당하면 40~60% 확률로 회색곰의 격노가 자동으로 3초 동안 활성화됩니다.</span></p>'},{display:"show",ver:"sea1",job:"nec",grade:"leg",parts:"acc",icon:"off",type:"off",name:"신성모독자의(사악함, 공격력)",detail:'<p class="gem_effect"><span class="acc">시체 주위를 걸어가면 매초 장착 중인 시체 기술이 자동으로 시전 되며 30~40% 감소한 피해를 줍니다.</span></p>'},{display:"show",ver:"sea1",job:"nec",grade:"leg",parts:"acc",icon:"def",type:"def",name:"노화 오라의(흉포함, 방어력)",detail:'<p class="gem_effect"><span class="acc">주위에 적이 5마리 이상 있을 때, 주위 적들에게 자동으로 5~15초 동안 노화의 저주를 거는 오라를 얻습니다.</span></p>'},{display:"show",ver:"sea1",job:"nec",grade:"leg",parts:"acc",icon:"uti",type:"uti",name:"얼어붙은 공포의(간악함, 보조)",detail:'<p class="gem_effect"><span class="acc">행운의 적중: 최대 10~20% 확률로 2.5초 동안 공포에 질리게 합니다. 공포에 질린 적이 매초 20% 확률로 빙결됩니다.</span></p>'},{display:"show",ver:"sea1",job:"nec",grade:"leg",parts:"acc",icon:"tra",type:"tra",name:"대향연의(진노함, 초월적 - 단계 IV)",detail:'<p class="gem_effect"><span class="acc">각각의 하수인이 매초 정수를 1.0~2.0 고갈시키지만 50~75%의 추가 피해를 줍니다. 하수인이 없을 경우 이 추가 피해 효과가 자신에게 적용되어 매초 정수를 5씩 고갈시킵니다.</span></p>'},{display:"show",ver:"sea1",job:"rog",grade:"leg",parts:"acc",icon:"off",type:"off",name:"집속탄의(사악함, 공격력)",detail:'<p class="gem_effect"><span class="acc">행운의 적중: 최대 20% 확률로 섬광 수류탄을 3개 발사해 26~32의 물리 피해를 주고 적을 0.50초 동안 기절시킵니다.</span></p>'},{display:"show",ver:"sea1",job:"rog",grade:"leg",parts:"acc",icon:"def",type:"def",name:"속임수의(흉포함, 방어력)",detail:'<p class="gem_effect"><span class="acc">기만 기술 사용 시, 적을 도발하는 불안정한 그림자 미끼 덫을 그 자리에 놓습니다. 그림자 미끼 덫은 6.0초 후에 폭발하여 680~1020의 암흑 피해를 줍니다. 이 효과는 5초에 한 번씩만 발동합니다.</span></p>'},{display:"show",ver:"sea1",job:"rog",grade:"leg",parts:"acc",icon:"uti",type:"uti",name:"절단 사격의(간악함, 보조)",detail:'<p class="gem_effect"><span class="acc">행운의 적중: 최대 20~40% 확률로 암살 기술이 적을 3초 동안 40% 감속시키고, 명사수 기술이 적을 밀쳐냅니다.</span></p>'},{display:"show",ver:"sea1",job:"rog",grade:"leg",parts:"acc",icon:"tra",type:"tra",name:"사악한 약제사의(진노함, 초월적 - 단계 IV)",detail:'<p class="gem_effect"><span class="acc">공격 시 5~15% 확률로 모든 주입 효과를 원래 지속 효력의 40~50%로 적용합니다.</span></p>'},{display:"show",ver:"sea1",job:"soc",grade:"leg",parts:"acc",icon:"off",type:"off",name:"탈라샤의(사악함, 공격력)",detail:'<p class="gem_effect"><span class="acc">각 고유 원소로 피해를 줄 때마다 3~10초 동안 주는 피해가 7~12% 증가합니다.</span></p>'},{display:"show",ver:"sea1",job:"soc",grade:"leg",parts:"acc",icon:"def",type:"def",name:"주문 파괴의(흉포함, 방어력)",detail:'<p class="gem_effect"><span class="acc">원소 피해를 받은 후에 5초 동안 해당 원소에 대한 저항이 20~40% 증가합니다.</span></p>'},{display:"show",ver:"sea1",job:"soc",grade:"leg",parts:"acc",icon:"uti",type:"uti",name:"앙심의(간악함, 보조)",detail:'<p class="gem_effect"><span class="acc">군중 제어 효과에 걸렸을 때, 20~40% 확률로 해당 효과를 건 적과 주위 모든 적이 3초 동안 같은 효과에 걸립니다.</span></p>'},{display:"show",ver:"sea1",job:"soc",grade:"leg",parts:"acc",icon:"tra",type:"tra",name:"전능의(진노함, 초월적 -단계 IV)",detail:'<p class="gem_effect"><span class="acc">투사체를 발사하는 핵심 기술이 마나를 모두 소모합니다. 추가 마나를 35~45 소모할 때마다, 추가 투사체를 하나 발사하고 피해가 3.0~5.0% 증가합니다.</span></p>'},];return t.init=function(){t.setElement(),t.expandFunc(),t.aspectLayer(),t.aspectDB(),t.spiritBoons(),t.jobSelect(),$(window).on("scroll resize",function(){t.scrollFunc()}),t.setGems(),t.layerFuncInit(),t.itemOption(),t.getSetting(),t.uiFunc()},t.setElement=function(){a.body=$("body"),a.container=$("#container"),a.job=a.container.attr("data-job-select"),a.headerH=$("#header").outerHeight(),a.aspect=$("#container .inven .equ .option"),a.aspectList=a.container.find("#aspectList"),a.boardWrap=a.container.find("#board"),a.spiritBoons=a.container.find("#spirit"),a.aspectOpen=a.container.find("[aria-controls=aspectSelect]"),a.aspectTarget=$("#"+a.aspectOpen.attr("data-target")),a.aspectLayer=$("#"+a.aspectOpen.attr("aria-controls")),a.gems=$("#container .inven .equ .gems .each-gem"),a.gemOpen=a.container.find("[aria-controls=gemSelect]"),a.gemLayer=$("#"+a.gemOpen.attr("aria-controls")),a.lastButton=a.aspectOpen.is(".latest"),a.optionList=$("#optionList"),a.settingInput=$("input[type=text]"),a.invenOptionList=$("#container .inven .equ .option-list"),a.delOpt=$(".button-option-del"),a.urlStr=window.location.href,a.url=new URL(a.urlStr),a.urlParams=a.url.searchParams},t.uiFunc=function(){$("#wrap [data-display=hide]").remove(),$(document).on("keydown","[role=button]",function(t){(32===t.keyCode||13===t.keyCode)&&(t.preventDefault(),$(this).trigger("click"))}),$("[role=switch][aria-checked]").on("click",function(){var t=$(this).attr("data-tag");$(this).attr("aria-checked",function(t,a){return"true"==a?"false":"true"}),$(this).is(".button-gem[aria-checked=false]"),a.body.toggleClass(t)}),$(".button-url").on("click",function(){if($(this).is(".link-button")){var t=$(this).siblings(".setting-url").val();t.length>0&&window.open(t,"_blank")}else $(this).is(".del-button")&&$(this).hide().siblings(".setting-url").val("").focus()}),$("#container .inven .equ").each(function(){$(this).on("click",".box-aspect .aspect-detail",function(){$(this).find(".aspect-parts, .acquest").length>0&&$(this).toggleClass("active")}).on("click",".box-aspect .gem-info",function(){$(this).find(".detail").length>0&&$(this).toggleClass("active")})}),$("[aria-expanded][aria-controls]").on("click",function(){$(this).is("[aria-expanded=true]")?t.expandFunc($(this),!1):t.expandFunc($(this),!0)}),$(".button-expand-close").on("click",function(){$("[aria-controls="+$(this).parents("[aria-hidden]").attr("id")+"]").trigger("click")}),a.settingInput.each(function(){void 0==a.urlParams.get($(this).attr("id"))&&$("#"+$(this).attr("id")).siblings(".del-button").hide(),$(this).on("focus keyup",function(){$(this).val().length<1?$(this).siblings(".del-button").hide():$(this).siblings(".del-button").show()}).on("focusout blur",function(){$(this).val().length<1?(a.urlParams.delete($(this).attr("id")),$(this).siblings(".del-button").hide()):(a.urlParams.set($(this).attr("id"),$(this).val()),$(this).siblings(".del-button").show()),t.getSetting()}).on("click",function(){$(this).select()})}),a.spiritBoons.find(".button-spirit[aria-selected=true]").each(function(){$(this).parents(".spirit-grid").find(".spirit-description").append('<p class="spirit-selected" data-target="'+$(this).attr("id")+'"><span class="text-name">'+$(this).text()+'</span><span class="text-detail">'+$(this).attr("title")+"</span></p>")})},t.itemOption=function(){var e=$(".button-option-select"),s=$("#"+e.attr("aria-controls"));s.find(".option-input"),s.find(".button-copy");var i=s.find(".selected-option"),n=$(".box-alert");e.on("click",function(){if($(this).parents(".equ").find(".option").is("[data-target]")){var a=$(this).attr("data-option-parts"),n=$(this).siblings(".option-list");1>!n.find(".grid-option").length?$(this).removeClass("modify"):$(this).addClass("modify"),s.attr("data-select-option-parts",a),$(".select-option .grid-option").attr("aria-selected",!1),i.empty().append(n.find(".grid-option").clone()),i.find(".grid-option").each(function(){$("#"+$(this).attr("aria-controls")).attr("aria-selected",!0)}),$(".option-group").each(function(){$(this).show(),$(this).find(".grid-option:visible").length<1&&$(this).hide()}),t.fixedViewPort(!0)}else t.layerFunc(e.attr("aria-controls"),!1),t.layerFunc("selectAspect",!0,"위상을 먼저 선택해주세요.",!1)}),s.on("click",".select-option .grid-option",function(t){!$(this).is("[aria-selected=true]")&&$(".selected-option .grid-option").length<4?(i.append($(this).clone().attr("aria-controls",$(this).attr("id")).removeAttr("id")),$(this).attr("aria-selected",!0)):(n.html('<p class="option-alert">선호 옵션은 4개까지만 선택 가능합니다. 선택했던 옵션을 삭제하고 재선택해주세요.</p>'),$(".option-alert").delay(100).animate({"max-height":"50px"},500).delay(2e3).animate({"max-height":"0px"},500))}).on("click",".selected-option .option-del",function(){var t=$("#"+$(this).parent().attr("aria-controls"));$(this).parent().remove(),t.attr("aria-selected",!1)}).on("click",".option-submit",function(){var e=[],s=$(".trigger-active").siblings(".option-list");s.empty().append($(".selected-option .grid-option").clone()),t.layerFunc("optionSelect",!1),$(".selected-option .grid-option").each(function(t,a){var i=$(a).attr("aria-controls");e.push(i),s.attr("data-target",e)}),a.urlParams.delete(s.attr("id")),a.urlParams.set(s.attr("id"),e),t.getSetting()})},t.jobSelect=function(){$("#header .button-job, .button-reset").on("click",function(){var e=$(this),s=$(this).attr("data-tab-select");function i(e){var i=e;a.body.is(".scroll-lock")||$("html, body").animate({scrollTop:"0"},300),e.is(".button-job")&&(i.attr("aria-selected",!0).siblings().attr("aria-selected",!1),a.container.attr("data-job-select",s),i.hasClass("sub-equ-char")?$(".inven-wep .equ").eq(1).removeClass("wep").addClass("sub"):$(".inven-wep .equ").eq(1).addClass("wep").removeClass("sub"),$("#container .inven-spirit .spirit-grid").removeClass("active").find(".button-spirit").attr("aria-selected",!1).prop("disabled",!1),$("#container .spirit-description").empty(),"dru"==s?$("#wep2-opt").attr("data-option-parts","sub"):"nec"==s?($("#wep2-opt").attr("data-option-parts","shl"),$("#wep4-opt").attr("data-option-parts","sub")):$("#wep2-opt, #wep4-opt").attr("data-option-parts","wep"),a.urlParams.set("job",s)),t.delEqu(),t.delGems(),t.delUrl(),t.delOpt(),t.delSpirit(),t.getSetting(),t.aspectReset()}$(this).is("[aria-selected=true]")||($("[aria-controls=aspectSelect][data-target]").length>0||$("[aria-controls=gemSelect][data-gem-icon]").length>0||""!==$("input[type=text]").val()?(t.layerFunc("settingReset",!0,'현재 셋팅된 <strong>위상(옵션)/보석/입력값</strong>등이 있습니다.<br>확인을 누르면 셋팅된  <strong class="underline">위상(옵션)/보석/입력값</strong> 들이 초기화 됩니다. <br>그래도 초기화 하시겠습니까?',!0),$(document).on("click","#settingReset .button-submit",function(){i(e)})):i(e))}),$(".aspect-head button").on("click",function(){var t=$(this).attr("class");$(this).is("[aria-selected]")&&$(this).attr("aria-selected",!0).siblings("[aria-selected]").attr("aria-selected",!1),a.aspectList.attr("data-filter",t)})},t.setGems=function(){$(".inven .equ").each(function(){$(this).find(".gems").length>0&&$(this).attr("data-has","gem")});var s=$("#gemSelect");$.each(e,function(t,a){s.find(".gems-list").append('<div data-display="'+a.display+'" class="gems-grid" data-job="'+a.job+'" data-grade="'+a.grade+'" data-parts="'+a.parts+'"><button class="button-gem each-gem" data-gem-icon="'+a.icon+'" data-gem-grade="'+a.grade+'" id="G'+t+'"><span class="gem-info"><span class="name">'+a.name+'</span><span class="detail">'+a.detail+"</span></span></button></div>")}),s.find("[data-grade=leg]").wrapAll('<div class="gems-group" data-group="leg"></div>'),s.find("[data-grade=nor]").wrapAll('<div class="gems-group" data-group="nor"></div>'),a.gemOpen.on("click",function(){var e=$(this).attr("data-gem-type");if($(this).parents(".inven-gems"),$("[aria-controls=gemSelect]").removeClass("active"),$(this).addClass("active"),s.addClass("active").attr("data-gem-type",e),$(this).is(".each-gem")?(s.addClass("layer-dimmed").removeClass("layer-bottom"),setTimeout(function(){$("html, body").animate({scrollTop:s.offset().top-a.headerH+"px"},300)},100),t.fixedViewPort(!0)):(s.removeClass("layer-dimmed").addClass("layer-bottom"),t.fixedViewPort(!1)),$(this).is(".selected")){var i=$("#"+$(this).attr("data-target"));s.find(".button-gem").removeClass("selected"),i.addClass("selected").focus()}else s.find(".button-gem").removeClass("selected"),s.find(".layer-body").animate({scrollTop:"0"},300)}),s.on("click",".button-gem, .button-close",function(){if($(this).is(".button-gem")){var e=$(this).attr("data-gem-icon"),i=$(this).attr("id"),n=$("[aria-controls=gemSelect].active").attr("id");$("[aria-controls=gemSelect].active").addClass("selected").attr({"data-gem-icon":e,"data-target":i}),a.urlParams.set(n,i),t.getSetting()}$("[aria-controls=gemSelect]").removeClass("active"),$(".inven-gems .option").removeClass("active"),s.removeClass("active"),s.removeAttr("data-gem-type").find(".gems-list"),t.fixedViewPort(!1)})},t.scrollFunc=function(){$(window).scroll(function(){var t=$(this).scrollTop();t>40?a.body.addClass("header-flip"):a.body.removeClass("header-flip");var e=document.documentElement.scrollHeight-document.documentElement.clientHeight;$(".bar").css("width",t/e*100+"%")})},t.aspectLayer=function(){a.aspectOpen.on("click",function(){var e=$(this).parents(".equ").attr("class").split(" ")[1],s=$("#"+$(this).attr("aria-controls"));if(a.aspectOpen.removeClass("active latest"),$(".inven-aspect-select").removeClass("active").removeAttr("data-sorting"),s.addClass("active").attr("data-sorting",e),a.container.find(".inven").addClass("active"),$(this).addClass("active latest"),$(this).is(".selected")?$(".sort-by-dis").attr("disabled",!1):$(".sort-by-dis").attr("disabled",!0),t.layerSort(e),$(this).is(".selected")){var i=$("#"+$(this).attr("data-target"));a.aspectLayer.find(".button-aspect").removeClass("selected"),i.addClass("selected").focus()}else a.aspectLayer.find(".button-aspect").removeClass("selected"),s.find(".box-aspect-select").animate({scrollTop:"0"},300);var n=void 0==$(this).parents(".equ").attr("data-multiply")?10:$(this).parents(".equ").attr("data-multiply");t.aspectMultiply(n),t.fixedViewPort(!0)}),$(".js-disabled").on("click",function(){var e=$(".inven .equ .option.latest").attr("data-target");$(this).is(".sort-by-dis")&&(a.urlParams.delete($(".inven .equ .option.latest").attr("id"),$(".inven .equ .option.latest").attr("data-target")),t.getSetting(),a.aspectList.find("#"+e).attr("aria-selected",!1),$(".inven .equ .option.latest").parent().removeAttr("data-parts data-ver"),$(".inven .equ .option.latest").removeAttr("data-target").removeClass("selected").siblings(".text").find(".box-aspect").empty(),$(".inven .equ .option.latest").is("#wep2, #wep4")&&(t.wepChange(!0),"bab"==a.job&&t.wepChange(!1))),a.aspectOpen.removeClass("active"),$(this).parents(".inven-aspect-select").removeClass("active").removeAttr("data-sorting"),a.container.find(".inven").removeClass("active"),t.fixedViewPort(!1)})},t.aspectMultiply=function(t){a.aspectList.find(".txt_calc").each(function(){var a=$(this).attr("data-origin");$(this).text(parseInt(a*t/10))})},t.aspectReset=function(){a.aspectOpen.removeClass("active selected latest").removeAttr("data-target"),a.aspectLayer.removeClass("active").removeAttr("data-sorting"),a.container.find(".inven").removeClass("active").find(".equ .text .detail, .equ .text .more").empty().removeClass("type-uni type-leg"),a.aspectButton.attr("aria-selected",!1).removeAttr("data-select-parts"),a.aspectOpen.parent().removeAttr("data-parts data-ver"),a.aspect.removeClass("active").removeAttr("data-gem-icon"),a.gemOpen.removeAttr("data-gem-icon"),t.wepChange(!0),$("#container .inven .equ .button-option-select").removeClass("modify"),$(".box-aspect").empty(),$("#previewImg").empty(),$(".option-list").removeAttr("data-target").empty(),a.delOpt.removeAttr("style"),t.layerFunc("optionSelect",!1),t.fixedViewPort(!1)},t.layerSort=function(t){var t=a.aspectLayer.attr("data-sorting");$job=a.container.attr("data-job-select"),a.aspectLayer.find(".box__aspect-grid").addClass("hide").removeClass("show"),a.aspectLayer.find(".box__aspect-grid."+t+"[data-job="+$job+"], .box__aspect-grid."+t+"[data-job=com]").removeClass("hide").addClass("show")},t.invCheck=function(e){var s=[];a.aspectOpen.each(function(i){var n=void 0!==$(this).attr("data-target")?$(this).attr("data-target"):"";s.push(n),e==$(this).attr("data-target")&&($(this).not(".latest").attr("data-target",e).removeAttr("data-target").removeClass("selected").siblings(".text").find(".box-aspect").empty(),$(this).not(".latest").parent().removeAttr("data-parts data-ver"),("dru"==a.job||"soc"==a.job||"nec"==a.job)&&(e!=$("#wep1").attr("data-target")||$("#wep2, #wep4").is(".selected")?(e==$("#wep2").attr("data-target")||$("#wep4").attr("data-target")&&!$("#wep1").is(".selected"))&&(console.log("무기 OFF"),t.wepChange(!1)):(console.log("무기 ON"),t.wepChange(!0))),a.urlParams.delete($(this).attr("id"),e),t.getSetting())}),$.each(s,function(t){$("#"+s[t]).attr({"aria-selected":!0})})},t.wepChange=function(t){var a=$("#container").attr("data-job-select");t?($("#wep1").siblings().removeClass("single-gem").parents(".equ").attr("data-multiply","20"),$("#wep2, #wep4").parents(".equ").attr("data-wep-type","sub")):($("#wep1").siblings(".gems").addClass("single-gem").parents(".equ").attr("data-multiply","10"),$("#wep2, #wep4").parents(".equ").removeAttr("data-wep-type"),("rog"==a||"bab"==a)&&$("#wep1").siblings(".gems").removeClass("single-gem").parents(".equ").attr("data-multiply","20"))},t.aspectDB=function(){a.aspectButton=a.container.find(".button-aspect"),a.container.on("click",".button-aspect",function(){$(this).find(".aspect-name"),$(this).find(".aspect-more").html(),$(this).find(".aspect-parts").html();var e=$(".inven .equ .option.active").siblings(".text"),s=$(".inven .equ .option.active").attr("data-target");a.aspectID=$(this).attr("id"),a.partsID=$(".inven .equ .option.active").attr("id"),$(".sort-by-all").trigger("click"),$("#"+s).attr("aria-selected",!1),$(".inven .equ .option.active").addClass("selected").attr({"data-target":$(this).attr("id")}).parent().attr({"data-parts":$(this).parent().attr("data-parts"),"data-ver":$(this).parent().attr("data-ver")}),a.aspectOpen.removeClass("active"),a.aspectLayer.removeClass("active"),a.container.find(".inven").removeClass("active"),$(this).attr({"data-select-parts":a.partsID}),$(this).find(".aspect-name").hasClass("type-uni")?e.addClass("type-uni"):e.removeClass("type-uni"),t.invCheck(a.aspectID),a.urlParams.set(a.partsID,a.aspectID),t.getSetting(),t.fixedViewPort(!1)})},t.setAspect=function(t,a){$("#container").attr("data-job-select");var e=$("#"+t),s=$("#"+a),i=s.find(".aspect-name").html(),n=s.find(".aspect-more").html();(!a==void 0||""==!a)&&(e.addClass("selected").attr("data-target",a),e.siblings().find(".detail").text(i),e.siblings().find(".more").html(n),s.attr({"aria-selected":!0,"data-select":a}),s.find(".aspect-name").hasClass("type-uni")?e.siblings().find(".detail").addClass("type-uni"):e.siblings().find(".detail").removeClass("type-uni"))},t.expandFunc=function(t,a){var e=$("#"+$(t).attr("aria-controls"));a?($(t).addClass("expend").attr("aria-expanded",!0),e.attr("aria-hidden",!0).slideDown(200)):($(t).removeClass("expend").attr("aria-expanded",!1),e.attr("aria-hidden",!1).slideUp(200))},t.spiritBoons=function(){a.spiritBoons.find("button");var e=a.spiritBoons.find(".spirit-grid");e.each(function(s){function i(){}$(this).find(".button-spirit"),$(this).on("click",".button-blessing[aria-selected=false]",function(){var s=[];e.find(".button-blessing").attr("aria-selected",!1),$(this).attr("aria-selected",!0),e.find("[aria-selected]").attr("disabled",!1),e.find("[aria-selected=true] ~ [aria-selected=true]").attr("aria-selected",!1),void 0!==$("[data-target="+$(".spirit-grid.active").find("[aria-selected=true]").attr("id")+"]").siblings().attr("data-target")&&($("#"+$("[data-target="+$(".spirit-grid.active").find("[aria-selected=true]").attr("id")+"]").siblings().attr("data-target")).prop("aria-selected",!1),$("[data-target="+$(".spirit-grid.active").find("[aria-selected=true]").attr("id")+"]").siblings().remove(),$(".button-spirit[aria-selected=true]").each(function(){s.push($(this).attr("id")),$("#spirit").attr("data-target",s)}),a.urlParams.set("SPD",$("#spirit").attr("data-target")),t.getSetting()),e.find(".button-blessing").attr("aria-selected",!1),$(this).attr("aria-selected",!0),$(this).parents(".spirit-grid").addClass("active").siblings().removeClass("active"),$(".description").slideUp(300),a.urlParams.set("SPB",a.spiritBoons.find(".button-blessing[aria-selected=true]").attr("id")),t.getSetting()}).on("click",".button-spirit[aria-selected]",function(){var e=[];$(this).attr("name");var s=$(this).text(),i=$(this).attr("id"),n=$(this).attr("title"),r=$(this).parents(".spirit-grid").find(".spirit-description"),c=$(this).parents(".spirit-grid"),o=$(this).parents(".spirit-frame");c.is(".active")?($(this).is("[aria-selected=true]")?($(this).attr("aria-selected",!1),$(".spirit-description").find("[data-target]").length>1&&$(".spirit-description [data-target="+i+"]").remove()):($(this).attr("aria-selected",!0),r.append('<p class="spirit-selected" data-target="'+i+'"><span class="text-name">'+s+'</span><span class="text-detail">'+n+"</span></p>")),2==o.find("[aria-selected=true]").length?a.spiritBoons.find(".spirit-grid.active").find("[aria-selected=false]").prop("disabled",!0):a.spiritBoons.find(".spirit-grid.active").find("[aria-selected]").prop("disabled",!1)):($(this).attr("aria-selected",!0).siblings().attr("aria-selected",!1),r.html('<p class="spirit-selected" data-target="'+i+'"><span class="text-name">'+s+'</span><span class="text-detail">'+n+"</span></p>")),$(".button-spirit[aria-selected=true]").each(function(){e.push($(this).attr("id")),$("#spirit").attr("data-target",e)}),a.urlParams.set("SPD",$("#spirit").attr("data-target")),t.getSetting()})})},t.getSetting=function(){var e=a.urlParams.get("job");null==e?(a.urlParams.set("job","dru"),$("#header .button-job[data-tab-select]").attr("aria-selected",!1),$("#header .button-job[data-tab-select=dru]").attr("aria-selected",!0)):(a.urlParams.set("job",e),$("#container").attr("data-job-select",e),$("#header .button-job[data-tab-select]").attr("aria-selected",!1),$("#header .button-job[data-tab-select="+e+"]").attr("aria-selected",!0)),a.aspect.each(function(){var e=$(this).parents(".equ"),s=$(this).attr("id"),i=$(this).siblings(".text").find(".box-aspect");$(this).attr("data-target",a.urlParams.get($(this).attr("id"))),$(this).is("[data-target]")&&(e.attr({"data-parts":$("#"+$(this).attr("data-target")).parent().attr("data-parts"),"data-ver":$("#"+$(this).attr("data-target")).parent().attr("data-ver")}).find(".option").addClass("selected"),i.empty().append($("#"+$(this).attr("data-target")).find(".aspect-detail").clone().attr({role:"button",tabindex:"0"})),$("#"+$(this).attr("data-target")).attr({"aria-selected":!0,"data-select-parts":s})),$(this).siblings(".text").find(".aspect-name").is(".type-uni")&&$(this).siblings(".text").addClass("type-uni"),($("#wep2, #wep4").is(".selected")&&"dru"==a.job||"soc"==a.job||"nec"==a.job)&&t.wepChange(!1)}),a.gems.each(function(){$(this).attr("data-target",a.urlParams.get($(this).attr("id"))),$(this).attr("data-gem-icon",$("#"+$(this).attr("data-target")).attr("data-gem-icon")),$(this).is("[data-target]")&&"leg"==$("#"+$(this).attr("data-target")).attr("data-gem-grade")?($(this).parents(".equ").find(".text .box-aspect .gem-info").remove(),$(this).parents(".equ").find(".text .box-aspect").append($("#"+$(this).attr("data-target")).find(".gem-info").clone().attr({"data-gem-type":$("#"+$(this).attr("data-target")).attr("data-gem-icon"),role:"button",tabindex:"0"}))):$(this).parents(".equ").find(".text .box-aspect .gem-info").remove()}),a.settingInput.each(function(){var t=$(this).attr("id");$("#"+t).val(a.urlParams.get(t))}),a.spiritBoons.find(".button-spirit").each(function(){var e=$("#spirit");if($(this).parents(".list-type").siblings(".spirit-description"),$("#"+a.urlParams.get("SPB")).length>0&&(t.expandFunc(".spirit-open",!0),$("#"+a.urlParams.get("SPB")).attr("aria-selected",!0).parents(".spirit-grid").addClass("active"),$("#container .inven-spirit .description").hide()),e.attr("data-target",a.urlParams.get("SPD")),e.is("[data-target]")){var s=e.attr("data-target").split(",");$.each(s,function(t,a){$("#"+a).attr("aria-selected",!0)}),$(".spirit-grid.active").find(".button-spirit[aria-selected=true]").length>=2?$(".spirit-grid.active").find(".button-spirit[aria-selected=false]").attr("disabled",!0):$(".spirit-grid.active").find(".button-spirit[aria-selected]").attr("disabled",!1)}}),a.invenOptionList.each(function(t){var e=$(this),s=$(this).attr("id");if($(this).attr("data-target",a.urlParams.get(s)),void 0==$(this).attr("data-target")||""==$(this).attr("data-target"))a.urlParams.delete($(this).attr("id"));else if(0==e.find(".grid-option").length){var i=$(this).attr("data-target").split(",");a.body.addClass("option-view").find("#container .box-title .button-option-view").attr("aria-checked",!0),e.siblings(".button-option-select").addClass("modify"),$.each(i,function(t,a){e.append($("#"+a).clone().removeAttr("id").attr("aria-controls",a))})}}),$(".option-list .grid-option").length>0&&(a.delOpt.show(),a.delOpt.on("click",function(){t.layerFunc("optionDelete",!0,"선택된 <strong>모든 부위 옵션이 초기화</strong> 됩니다.<br>진행 하시겠습니까?",!0),$(document).on("click","#optionDelete .button-submit",function(){$(".option-list").empty().removeAttr("data-target"),$("#container .inven .equ .button-option-select").removeClass("modify"),a.delOpt.hide(),t.delOpt(),t.getSetting()})})),history.replaceState({},null,a.url)},t.delEqu=function(){a.aspect.each(function(){var t=$(this).attr("id");a.urlParams.delete(t)})},t.delGems=function(){a.gems.each(function(){var t=$(this).attr("id");a.urlParams.delete(t)})},t.delUrl=function(){a.settingInput.each(function(){var t=$(this).attr("id");a.urlParams.delete(t)})},t.delOpt=function(){a.invenOptionList.each(function(){var t=$(this).attr("id");a.urlParams.delete(t)})},t.delSpirit=function(){a.urlParams.delete("SPB"),a.urlParams.delete("SPD")},t.layerFuncInit=function(){$("[aria-haspopup=dialog][aria-controls]").on("click",function(a){a.preventDefault();var e=$(this).attr("aria-controls");void 0==$("#"+e).find(".dimmed").get(0)&&($("#"+e).append('<div class="dimmed" role="none"></div>'),t.layerFuncClose()),void 0!==$("#"+e).get(0)&&($(this).is(".button-option-select")&&$(this).addClass("trigger-active"),t.layerFunc(e,!0))})},t.layerFuncClose=function(){$(".box-layer").on("click","[data-dismiss=modal], .dimmed",function(a){a.preventDefault();var e=$(this).parents("[role=dialog], [role=alertdialog]").attr("id");$("[aria-controls="+e+"]").removeClass("trigger-active"),t.layerFunc(e,!1)})},t.layerFunc=function(a,e,s,i){if($(".common-layer").attr("id",a),void 0!==$("#"+a).get(0)){var n=$("#"+a),r=$("#layerContent"),c=0,o=0;if(i?(n.attr("role","dialog"),n.find(".button-cancel").length<1&&n.find(".box-button").append('<button class="button-cancel" data-dismiss="modal">취소</button>')):(n.attr("role","alertdialog"),n.find(".box-button .button-cancel").remove()),e){n.is(".active")||n.addClass("active").attr({"aria-hidden":"false"});var l=n.find('a[href], area[href], input:not([disabled], [aria-hidden=true]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, [tabindex="0"], [contenteditable]'),c=l[0],o=l[l.length-1];c.focus(),void 0==$("#"+a).find(".dimmed").get(0)&&($("#"+a).append('<div class="dimmed" role="none"></div>'),t.layerFuncClose()),r.html(s),n.bind("keydown",d)}else r.empty(),n.unbind("keydown",d,!1),n.removeClass("active").attr({"aria-hidden":"true"}),$("[aria-haspopup=dialog][aria-controls="+a+"]").length>0?$("[aria-haspopup=dialog][aria-controls="+a+"]").removeClass("trigger-active"):void 0!==$(".active").get(0)?$(".active").find("[data-dismiss=modal]").focus():$("#container").attr("tabindex","0").focus();function d(t){9===t.keyCode&&(t.shiftKey?document.activeElement===c&&(t.preventDefault(),o.focus()):document.activeElement===o&&(t.preventDefault(),c.focus())),27===t.keyCode&&n.find("[data-dismiss=modal], .dimmed").click()}t.fixedViewPort(e)}},t.fixedViewPort=function(t){t?a.body.addClass("scroll-lock header-flip"):a.body.removeClass("scroll-lock header-flip")},{init:t.init,expandFunc:t.expandFunc,aspectDB:t.aspectDB,layerSort:t.layerSort,SetAspect:t.setAspect,layerFunc:t.layerFunc,scrollFunc:t.scrollFunc,getSetting:t.getSetting}}();D4SkillDB.init();